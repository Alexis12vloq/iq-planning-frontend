<div class="nueva-pauta-container">
  <!-- Información del Plan en una sola línea -->
  <div class="info-header-line">
    <div class="plan-title">Plan de Medios - {{ planData?.numeroPlan }}</div>
    <div class="plan-info">
      <span class="info-item">
        <span class="info-label">CLIENTE:</span>
        <span class="info-value">{{ planData?.cliente }}</span>
      </span>
      <span class="info-item">
        <span class="info-label">PRODUCTO:</span>
        <span class="info-value">{{ planData?.producto }}</span>
      </span>
      <span class="info-item">
        <span class="info-label">CAMPAÑA:</span>
        <span class="info-value">{{ planData?.campana }}</span>
      </span>
      <span class="info-item">
        <span class="info-label">VIGENCIA:</span>
        <span class="info-value">{{ formatearFechaSinDesfase(planData?.fechaInicio || '') }} - {{ formatearFechaSinDesfase(planData?.fechaFin || '') }}</span>
      </span>
    </div>
  </div>

  <!-- Botones de Acción Principales -->
  <div class="add-item-section">
    <button 
      mat-raised-button 
      color="primary" 
      class="add-item-btn"
      (click)="abrirModalNuevoItem()">
      <mat-icon>add_circle</mat-icon>
      Nuevo Item
    </button>
    
    <button 
      mat-raised-button 
      color="accent" 
      class="action-btn"
      (click)="exportarPlan()">
      <mat-icon>download</mat-icon>
      Exportar Plan
    </button>
    
    <button 
      mat-raised-button 
      color="warn" 
      class="action-btn"
      (click)="limpiarDatosPrueba()">
      <mat-icon>delete_sweep</mat-icon>
      Limpiar Datos
    </button>
    
    <button 
      mat-raised-button 
      color="warn" 
      class="action-btn"
      (click)="onRegresar()">
      <mat-icon>arrow_back</mat-icon>
      Regresar
    </button>
  </div>

  <!-- Grilla Principal de Programación -->
  <div class="programming-grid-container" *ngIf="itemsPauta.length > 0">
    <div class="grid-header">
      <h2 class="grid-title">
        <mat-icon>calendar_view_month</mat-icon>
        Programación de Medios ({{ itemsPauta.length }} items)
      </h2>
      <div class="grid-controls">
        <!-- Botones de expandir/contraer ocultos temporalmente -->
        <!-- 
        <button mat-icon-button color="primary" (click)="expandirTodosLosItems()" matTooltip="Expandir todo">
          <mat-icon>unfold_more</mat-icon>
        </button>
        <button mat-icon-button (click)="contraerTodosLosItems()" matTooltip="Contraer todo">
          <mat-icon>unfold_less</mat-icon>
        </button>
        -->
        <button mat-icon-button color="accent" (click)="exportarProgramacion()" matTooltip="Exportar">
          <mat-icon>download</mat-icon>
        </button>
      </div>
    </div>

    <!-- Contenedor con scroll horizontal -->
    <div class="grid-scroll-container">
      <!-- Tabla de programación -->
      <div class="programming-table">
        
        <!-- Encabezado de la tabla -->
        <div class="table-header">
          <!-- Columnas fijas -->
          <div class="fixed-columns">
            <div class="header-cell action-col"></div>
            <div class="header-cell medium-col">Medio</div>
            <div class="header-cell budget-col">Presupuesto</div>
          </div>
          
          <!-- Columnas de fechas (scrollables) -->
          <div class="scrollable-columns">
            <div 
              *ngFor="let fecha of fechasDelPlan; trackBy: trackByFecha"
              class="header-cell date-col"
              [class.weekend]="esFinDeSemana(fecha)"
              [class.today]="esHoy(fecha)">
              <div class="date-header">
                <div class="date-day">{{ fecha | date:'dd' }}</div>
                <div class="date-month">{{ fecha | date:'MMM' }}</div>
                <div class="date-weekday">{{ fecha | date:'EEE' }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Filas de items -->
        <div class="table-body">
          <div 
            *ngFor="let item of itemsPauta; let itemIndex = index; trackBy: trackByItem"
            class="table-row"
            [class.expanded]="itemsExpandidos[item.id]">
            
            <!-- Columnas fijas -->
            <div class="fixed-columns">
              <!-- Acción -->
              <div class="data-cell action-col">
                <div class="action-buttons">
                  <button 
                    mat-icon-button 
                    class="action-edit-button"
                    (click)="editarItem(item)"
                    matTooltip="Editar">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button 
                    mat-icon-button 
                    class="action-delete-button"
                    (click)="eliminarItem(item.id, itemIndex)"
                    matTooltip="Eliminar">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
              
              <!-- Medio -->
              <div class="data-cell medium-col">
                <div class="cell-content">
                  <mat-icon class="medio-icon">{{ obtenerIconoMedio(item.medio) }}</mat-icon>
                  <div class="medio-info">
                    <div class="medio-name">{{ item.medio }}</div>
                    <div class="medio-stats">{{ item.totalSpots }} spots</div>
                  </div>
                </div>
              </div>
              
              <!-- Presupuesto -->
              <div class="data-cell budget-col">
                <div class="cell-content">
                  <div class="budget-total">{{ item.valorTotal | currency:'USD':'symbol-narrow':'1.0-0' }}</div>
                  <div class="budget-sub">{{ item.totalSpots }} spots</div>
                </div>
              </div>
            </div>

            <!-- Columnas de fechas (scrollables) -->
            <div class="scrollable-columns">
              <div 
                *ngFor="let fecha of fechasDelPlan; trackBy: trackByFecha"
                class="data-cell date-col"
                [class.weekend]="esFinDeSemana(fecha)"
                [class.today]="esHoy(fecha)"
                [class.programmed]="tieneProgramacion(item.id, fecha)">
                
                <div class="date-cell-content">
                  <input 
                    type="text"
                    class="spots-input"
                    [value]="obtenerSpotsPorFecha(item.id, fecha) || ''"
                    (input)="actualizarSpotsPorFecha(item.id, fecha, $event)"
                    (keypress)="validarSoloNumeros($event)"
                    (paste)="validarPegado($event)"
                    (focus)="seleccionarTextoInput($event)"
                    placeholder="0"
                    maxlength="4"
                    title="Cantidad de spots para este día (solo números enteros)">
                </div>
              </div>
            </div>

            <!-- Sección de detalles expandibles oculta temporalmente -->
            <!-- 
            <div class="expanded-details" *ngIf="itemsExpandidos[item.id]">
              <div class="details-content">
                <div class="details-grid">
                  <div class="detail-group">
                    <h4>Información del Medio</h4>
                    <div class="detail-item" *ngFor="let key of getMainFields(item.datos).slice(0, 6)">
                      <span class="detail-label">{{ getFieldLabel(key) }}</span>
                      <span class="detail-value">{{ formatFieldValue(item.datos[key], key) }}</span>
                    </div>
                  </div>
                  
                  <div class="detail-group">
                    <h4>Programación</h4>
                    <div class="programming-stats">
                      <div class="stat-item">
                        <span class="stat-label">Días programados:</span>
                        <span class="stat-value">{{ contarDiasProgramados(item.id) }}</span>
                      </div>
                      <div class="stat-item">
                        <span class="stat-label">Total spots programados:</span>
                        <span class="stat-value">{{ contarTotalSpotsProgramados(item.id) }}</span>
                      </div>
                      <div class="stat-item">
                        <span class="stat-label">Costo por spot:</span>
                        <span class="stat-value">{{ calcularCostoPorSpot(item) | currency:'USD':'symbol-narrow':'1.2-2' }}</span>
                      </div>
                      <div class="stat-item">
                        <span class="stat-label">Promedio spots/día:</span>
                        <span class="stat-value">{{ calcularPromedioSpotsPorDia(item) | number:'1.1-1' }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="actions-row">
                  <button mat-button color="primary" (click)="editarItem(item)">
                    <mat-icon>edit</mat-icon>
                    Editar
                  </button>
                  <button mat-button color="accent" (click)="duplicarItem(item)">
                    <mat-icon>content_copy</mat-icon>
                    Duplicar
                  </button>
                  <button mat-button color="warn" (click)="eliminarItem(item.id, itemIndex)">
                    <mat-icon>delete</mat-icon>
                    Eliminar
                  </button>
                  <button mat-button (click)="toggleExpandirItem(item.id)">
                    <mat-icon>expand_less</mat-icon>
                    Contraer
                  </button>
                </div>
              </div>
            </div>

            <button 
              mat-icon-button 
              class="expand-button"
              [class.expanded]="itemsExpandidos[item.id]"
              (click)="toggleExpandirItem(item.id)"
              [matTooltip]="itemsExpandidos[item.id] ? 'Contraer detalles' : 'Ver detalles'">
              <mat-icon>{{ itemsExpandidos[item.id] ? 'expand_less' : 'expand_more' }}</mat-icon>
            </button>
            -->
          </div>
        </div>
      </div>
    </div>

    <!-- Resumen de programación -->
    <div class="programming-summary">
      <div class="summary-stats">
        <div class="summary-item">
          <span class="summary-label">Total Items:</span>
          <span class="summary-value">{{ itemsPauta.length }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Presupuesto Total:</span>
          <span class="summary-value">{{ calcularPresupuestoTotal() | currency:'USD':'symbol-narrow':'1.0-0' }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Días con Programación:</span>
          <span class="summary-value">{{ contarDiasConProgramacion() }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Spots Programados:</span>
          <span class="summary-value">{{ calcularTotalSpots() }} / {{ calcularTotalSpotsOriginales() }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay items -->
  <mat-card class="empty-state" *ngIf="itemsPauta.length === 0">
    <mat-card-content>
      <div class="empty-container">
        <mat-icon class="empty-icon">calendar_month</mat-icon>
        <h3>No hay items en el plan</h3>
        <p>Comienza agregando tu primer medio/vehículo al plan de medios. Podrás programar cada item día por día.</p>
        <button 
          mat-raised-button 
          color="primary" 
          (click)="abrirModalNuevoItem()"
          class="empty-action-btn">
          <mat-icon>add_circle</mat-icon>
          Crear Primer Item
        </button>
      </div>
    </mat-card-content>
  </mat-card>


</div> 