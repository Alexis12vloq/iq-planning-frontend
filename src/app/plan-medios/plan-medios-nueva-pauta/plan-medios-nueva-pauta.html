<div class="nueva-pauta-container">
  <!-- Información del Plan -->
  <mat-card class="info-card">
    <mat-card-header>
      <mat-card-title>Gestión de Pautas - Plan {{ planData?.numeroPlan }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="info-plan">
        <div class="info-item">
          <span class="info-label">CLIENTE:</span>
          <span class="info-value">{{ planData?.cliente }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">PRODUCTO:</span>
          <span class="info-value">{{ planData?.producto }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">CAMPAÑA:</span>
          <span class="info-value">{{ planData?.campana }}</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Botón para Agregar Nueva Pauta -->
  <div class="add-pauta-section">
    <button 
      mat-raised-button 
      color="primary" 
      class="add-pauta-btn"
      (click)="abrirModalNuevaPauta()">
      <mat-icon>add_circle</mat-icon>
      Agregar Nueva Pauta
    </button>
    <p class="add-pauta-hint">Haz clic para abrir el formulario de nueva pauta en una ventana modal</p>
  </div>

  <!-- Lista de Pautas Guardadas -->
  <mat-card class="pautas-card" *ngIf="pautasGuardadas.length > 0">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>list</mat-icon>
        Pautas Creadas ({{ pautasGuardadas.length }})
      </mat-card-title>
      <mat-card-subtitle>Gestiona tus pautas: eliminar, configurar calendario o ver detalles</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <div class="pautas-list">
        <div *ngFor="let pauta of pautasGuardadas; let i = index; trackBy: trackByPauta" class="pauta-item">
          <div class="pauta-header">
            <div class="pauta-title">
              <h4>{{ pauta.medio }} - Pauta #{{ i + 1 }}</h4>
              <div class="pauta-meta">
                <span class="meta-item">
                  <mat-icon>attach_money</mat-icon>
                  {{ pauta.valorTotal | currency:'USD':'symbol-narrow':'1.0-0' }}
                </span>
                <span class="meta-item">
                  <mat-icon>confirmation_number</mat-icon>
                  {{ pauta.totalSpots }} spots
                </span>
                <span class="meta-item" *ngIf="pauta.totalDiasSeleccionados">
                  <mat-icon>event</mat-icon>
                  {{ pauta.totalDiasSeleccionados }} días
                </span>
                <span class="meta-item" *ngIf="!pauta.totalDiasSeleccionados">
                  <mat-icon>event_busy</mat-icon>
                  Sin calendario
                </span>
              </div>
            </div>
            <div class="pauta-actions">
              <button 
                mat-icon-button 
                color="primary" 
                (click)="abrirCalendarioPauta(pauta)"
                matTooltip="Configurar calendario">
                <mat-icon>event</mat-icon>
              </button>
              <button 
                mat-icon-button 
                color="warn" 
                (click)="eliminarPauta(pauta.id, i)"
                matTooltip="Eliminar pauta">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
          
          <div class="pauta-details">
            <div class="details-grid">
              <ng-container *ngFor="let key of getMainFields(pauta.datos)">
                <div class="detail-item">
                  <span class="detail-label">{{ getFieldLabel(key) }}:</span>
                  <span class="detail-value">{{ formatFieldValue(pauta.datos[key], key) }}</span>
                </div>
              </ng-container>
            </div>
            
            <!-- Información del Calendario -->
            <div class="calendario-info" *ngIf="pauta.diasSeleccionados && pauta.diasSeleccionados.length > 0">
              <h5>
                <mat-icon>event</mat-icon>
                Calendario Configurado
              </h5>
              <div class="calendario-resumen">
                <span class="calendario-stat">
                  <strong>{{ pauta.totalDiasSeleccionados }}</strong> días seleccionados
                </span>
                <span class="calendario-stat">
                  <strong>{{ (pauta.valorTotal! / pauta.totalDiasSeleccionados!) | currency:'USD':'symbol-narrow':'1.0-0' }}</strong> por día
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Mensaje cuando no hay pautas -->
  <mat-card class="empty-state" *ngIf="pautasGuardadas.length === 0">
    <mat-card-content>
      <div class="empty-container">
        <mat-icon class="empty-icon">playlist_add</mat-icon>
        <h3>No hay pautas creadas</h3>
        <p>Comienza agregando tu primera pauta haciendo clic en el botón "Agregar Nueva Pauta"</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Botones de Acción -->
  <div class="action-buttons">
    <div class="left-buttons">
      <button mat-raised-button color="accent" type="button" (click)="onCargaExcel()">
        <mat-icon>upload</mat-icon>
        Carga Excel
      </button>
      <button mat-raised-button color="accent" type="button" (click)="onDescargaExcel()">
        <mat-icon>download</mat-icon>
        Descarga Excel
      </button>
    </div>
    <div class="right-buttons">
      <button mat-raised-button color="warn" type="button" (click)="onRegresar()">
        <mat-icon>arrow_back</mat-icon>
        Regresar al Resumen
      </button>
    </div>
  </div>
</div> 