<div class="nueva-pauta-container">
  <!-- Información del Plan -->
  <mat-card class="info-card">
    <mat-card-header>
      <mat-card-title>Gestión de Pautas - Plan {{ planData?.numeroPlan }}</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="info-plan">
        <div class="info-item">
          <span class="info-label">CLIENTE:</span>
          <span class="info-value">{{ planData?.cliente }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">PRODUCTO:</span>
          <span class="info-value">{{ planData?.producto }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">CAMPAÑA:</span>
          <span class="info-value">{{ planData?.campana }}</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Botón para Agregar Nueva Pauta -->
  <div class="add-pauta-section">
    <button 
      mat-raised-button 
      color="primary" 
      class="add-pauta-btn"
      (click)="abrirModalNuevaPauta()">
      <mat-icon>add_circle</mat-icon>
      Agregar Nueva Pauta
    </button>
    <p class="add-pauta-hint">Crea una nueva pauta que será mostrada como una grilla organizada por medio</p>
  </div>

  <!-- Grilla de Pautas Agrupadas por Medio -->
  <div class="pautas-grid-container" *ngIf="pautasGuardadas.length > 0 && pautasAgrupadasPorMedio.length > 0">
    <h2 class="grid-title">
      <mat-icon>grid_view</mat-icon>
      Pautas Organizadas ({{ pautasGuardadas.length }} total en {{ pautasAgrupadasPorMedio.length }} medios)
    </h2>
    
    <div class="pautas-grid">
      <div *ngFor="let grupo of pautasAgrupadasPorMedio; let grupoIndex = index" class="medio-group">
        <!-- Cabecera del Medio -->
        <div class="medio-header">
          <div class="header-info">
            <h3 class="medio-title">
              <mat-icon>{{ obtenerIconoMedio(grupo.medio) }}</mat-icon>
              {{ grupo.medio }}
            </h3>
            <div class="medio-stats">
              <span class="stat-item">
                <mat-icon>confirmation_number</mat-icon>
                {{ grupo.totalPautas }} pautas
              </span>
              <span class="stat-item">
                <mat-icon>attach_money</mat-icon>
                {{ grupo.valorTotal | currency:'USD':'symbol-narrow':'1.0-0' }}
              </span>
              <span class="stat-item">
                <mat-icon>play_circle</mat-icon>
                {{ grupo.totalSpots }} spots
              </span>
            </div>
          </div>
          <div class="header-actions">
            <button 
              mat-icon-button 
              color="primary"
              (click)="toggleGrupoMedio(grupoIndex)"
              [matTooltip]="grupo.expandido ? 'Contraer' : 'Expandir'">
              <mat-icon>{{ grupo.expandido ? 'expand_less' : 'expand_more' }}</mat-icon>
            </button>
          </div>
        </div>

        <!-- Items del Medio (Expandible) -->
        <div class="medio-items" *ngIf="grupo.expandido" [@slideAnimation]>
          <div class="items-grid">
            <div *ngFor="let pauta of grupo.pautas; let pautaIndex = index" 
                 class="pauta-card"
                 [class.highlight]="pautaSeleccionada === pauta.id">
              
              <!-- Encabezado de la Pauta -->
              <div class="pauta-card-header">
                <div class="pauta-number">
                  <span class="number-badge">{{ pautaIndex + 1 }}</span>
                </div>
                <div class="pauta-main-info">
                  <h4 class="pauta-title">Pauta #{{ pautaIndex + 1 }}</h4>
                  <div class="pauta-quick-stats">
                    <span class="quick-stat valor">{{ pauta.valorTotal | currency:'USD':'symbol-narrow':'1.0-0' }}</span>
                    <span class="quick-stat spots">{{ pauta.totalSpots }} spots</span>
                    <span class="quick-stat dias" *ngIf="pauta.totalDiasSeleccionados">
                      {{ pauta.totalDiasSeleccionados }} días
                    </span>
                  </div>
                </div>
                <div class="pauta-actions">
                  <button 
                    mat-icon-button 
                    color="primary" 
                    (click)="abrirCalendarioPauta(pauta)"
                    [matTooltip]="pauta.totalDiasSeleccionados ? 'Modificar calendario' : 'Configurar calendario'">
                    <mat-icon>{{ pauta.totalDiasSeleccionados ? 'event' : 'event_busy' }}</mat-icon>
                  </button>
                  <button 
                    mat-icon-button 
                    color="accent" 
                    (click)="duplicarPauta(pauta)"
                    matTooltip="Duplicar pauta">
                    <mat-icon>content_copy</mat-icon>
                  </button>
                  <button 
                    mat-icon-button 
                    color="warn" 
                    (click)="eliminarPauta(pauta.id, obtenerIndicePautaGlobal(grupo.medio, pautaIndex))"
                    matTooltip="Eliminar pauta">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
              
              <!-- Detalles de la Pauta (Compactos) -->
              <div class="pauta-card-content">
                <div class="details-compact">
                  <div class="detail-row" *ngFor="let key of getMainFields(pauta.datos).slice(0, 4)">
                    <span class="detail-label">{{ getFieldLabel(key) }}</span>
                    <span class="detail-value">{{ formatFieldValue(pauta.datos[key], key) }}</span>
                  </div>
                </div>
                
                <!-- Indicador de calendario -->
                <div class="calendario-indicator" *ngIf="pauta.diasSeleccionados && pauta.diasSeleccionados.length > 0">
                  <mat-icon class="calendario-icon">event_available</mat-icon>
                  <span class="calendario-text">
                    {{ pauta.totalDiasSeleccionados }} días programados • 
                    {{ (pauta.valorTotal! / pauta.totalDiasSeleccionados!) | currency:'USD':'symbol-narrow':'1.0-0' }}/día
                  </span>
                </div>
                
                <!-- Botón para ver más detalles -->
                <div class="expand-details">
                  <button 
                    mat-button 
                    color="primary" 
                    (click)="toggleDetallesPauta(pauta.id)"
                    class="expand-btn">
                    <mat-icon>{{ mostrarDetalles[pauta.id] ? 'expand_less' : 'expand_more' }}</mat-icon>
                    {{ mostrarDetalles[pauta.id] ? 'Menos detalles' : 'Ver más detalles' }}
                  </button>
                </div>
                
                <!-- Detalles Expandidos -->
                <div class="detalles-expandidos" *ngIf="mostrarDetalles[pauta.id]" [@slideAnimation]>
                  <div class="all-details">
                    <div class="detail-item" *ngFor="let key of getAllFields(pauta.datos)">
                      <span class="detail-label">{{ getFieldLabel(key) }}</span>
                      <span class="detail-value">{{ formatFieldValue(pauta.datos[key], key) }}</span>
                    </div>
                  </div>
                  
                  <!-- Información adicional -->
                  <div class="additional-info">
                    <div class="info-section">
                      <h5><mat-icon>schedule</mat-icon> Información Temporal</h5>
                      <p><strong>Fecha de creación:</strong> {{ pauta.fechaCreacion | date:'dd/MM/yyyy HH:mm' }}</p>
                      <p><strong>ID:</strong> {{ pauta.id }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay pautas -->
  <mat-card class="empty-state" *ngIf="pautasGuardadas.length === 0">
    <mat-card-content>
      <div class="empty-container">
        <mat-icon class="empty-icon">grid_off</mat-icon>
        <h3>No hay pautas creadas</h3>
        <p>Comienza creando tu primera pauta. Se organizará automáticamente en una grilla por medio de comunicación.</p>
        <button 
          mat-raised-button 
          color="primary" 
          (click)="abrirModalNuevaPauta()"
          class="empty-action-btn">
          <mat-icon>add_circle</mat-icon>
          Crear Primera Pauta
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Botones de Acción -->
  <div class="action-buttons">
    <div class="left-buttons">
      <button mat-raised-button color="accent" type="button" (click)="onCargaExcel()">
        <mat-icon>upload</mat-icon>
        Carga Excel
      </button>
      <button mat-raised-button color="accent" type="button" (click)="onDescargaExcel()">
        <mat-icon>download</mat-icon>
        Descarga Excel
      </button>
      <button mat-raised-button color="primary" type="button" (click)="expandirTodosLosGrupos()">
        <mat-icon>unfold_more</mat-icon>
        Expandir Todo
      </button>
      <button mat-raised-button type="button" (click)="contraerTodosLosGrupos()">
        <mat-icon>unfold_less</mat-icon>
        Contraer Todo
      </button>
      <button mat-raised-button color="warn" type="button" (click)="limpiarDatosPrueba()">
        <mat-icon>delete_sweep</mat-icon>
        Limpiar Datos Prueba
      </button>
    </div>
    <div class="right-buttons">
      <button mat-raised-button color="warn" type="button" (click)="onRegresar()">
        <mat-icon>arrow_back</mat-icon>
        Regresar al Resumen
      </button>
    </div>
  </div>
</div> 