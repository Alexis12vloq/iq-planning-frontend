<div class="resumen-container">
  <div class="scroll-wrapper">
    <div #content>
      <!-- Cabecera con título y selector de período -->
      <div class="resumen-header">
      <div class="header-content">
        <h1>Resumen del Plan: {{ resumenPlan.numeroPlan }} | Versión: {{ resumenPlan.version }}</h1>
        <mat-form-field class="periodo-selector">
          <mat-label>Seleccionar Período</mat-label>
          <mat-select [(ngModel)]="periodoSeleccionado" (ngModelChange)="onPeriodoChange($event)">
            <mat-option *ngFor="let periodo of periodos" [value]="periodo">
              {{ periodo.nombre }} {{ periodo.anio }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- Información del plan y botones -->
    <div class="plan-info-container">
      <!-- Información del plan -->
      <div class="plan-info">
        <div class="info-item">
          <span class="info-label">CLIENTE:</span>
          <span class="info-value">{{ resumenPlan.cliente }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">PRODUCTO:</span>
          <span class="info-value">{{ resumenPlan.producto }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">PERÍODO:</span>
          <span class="info-value">{{ periodoSeleccionado.nombre }} {{ periodoSeleccionado.anio }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">CAMPAÑA:</span>
          <span class="info-value">{{ resumenPlan.campana }}</span>
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="action-buttons">
        <div class="left-buttons">
          <button mat-raised-button class="action-button green-button" (click)="onAgregarMedio()">
            <mat-icon>add_circle</mat-icon> Agregar Medio
          </button>
          <button mat-raised-button class="action-button blue-button" (click)="onDescargaFlow()">
            <mat-icon>download</mat-icon> Descarga FlowChart
          </button>
          <button mat-raised-button class="action-button purple-button" (click)="onAprobarPlan()">
            <mat-icon>check_circle</mat-icon> Aprobar Plan de Medios
          </button>
        </div>
        <div class="right-buttons">
          <button mat-raised-button color="warn" (click)="onRegresar()">
            <mat-icon>arrow_back</mat-icon> Regresar
          </button>
        </div>
      </div>

      <!-- Tabla de medios -->
      <div class="table-container">
        <table class="medios-table">
          <!-- Encabezado -->
          <thead>
            <tr>
              <th class="col-medios">MEDIOS</th>
              <th class="col-proveedor">PROVEEDOR</th>
              <th class="col-semanas" colspan="5">
                <div class="semanas-header">
                  <div class="semanas-title">CRONOGRAMA</div>
                </div>
              </th>
              <th class="col-total">VALOR TOTAL</th>
              <th class="col-soi">% / SOI</th>
            </tr>
            <tr class="fechas-subheader">
              <th></th>
              <th></th>
              <th class="col-fecha" *ngFor="let semana of semanasConFechas">
                <div class="fecha-container">
                  <div class="semana-nombre">{{ semana.nombre }}</div>
                  <div class="fecha-rango">{{ semana.fechaInicio }} - {{ semana.fechaFin }}</div>
                </div>
              </th>
              <th></th>
              <th></th>
            </tr>
          </thead>

          <!-- Cuerpo de la tabla -->
          <tbody>
            <!-- Mostrar medios si existen -->
            <ng-container *ngIf="periodoSeleccionado.medios.length > 0">
              <ng-container *ngFor="let medio of periodoSeleccionado.medios; let i = index">
                <!-- Fila del medio -->
                <tr class="fila-medio" (dblclick)="onEditarMedio(medio)" title="Doble click para editar este medio">
                  <td>{{ medio.nombre }}</td>
                  <td>{{ medio.proveedor || 'Sin proveedor' }}</td>
                  <td colspan="5">
                    <div class="semanas-cell">
                      <div *ngFor="let activo of medio.semanas" 
                           class="semana-indicator"
                           [class.activo]="activo">
                      </div>
                    </div>
                  </td>
                  <td class="valor-total">{{ medio.valorNeto | currency:'USD':'symbol-narrow':'1.0-0' }}</td>
                  <td class="valor-soi">{{ calcularPorcentaje(medio.valorNeto) | number:'1.1-1' }}%</td>
                </tr>
                <!-- Fila de salidas -->
                <tr class="fila-salidas">
                  <td>SALIDAS</td>
                  <td></td>
                  <td colspan="5"></td>
                  <td class="valor-total">{{ medio.salidas }}</td>
                  <td class="valor-soi">{{ medio.soi | currency:'USD':'symbol-narrow':'1.0-0' }}</td>
                </tr>
                <!-- Fila de valor neto -->
                <tr class="fila-valor">
                  <td>Valor neto</td>
                  <td></td>
                  <td colspan="5"></td>
                  <td class="valor-total">{{ medio.valorNeto | currency:'USD':'symbol-narrow':'1.0-0' }}</td>
                  <td></td>
                </tr>
              </ng-container>
            </ng-container>
            
            <!-- Mostrar mensaje cuando no hay pautas -->
            <ng-container *ngIf="periodoSeleccionado.medios.length === 0">
              <tr class="fila-sin-pautas">
                <td colspan="9" class="text-center">
                  <div class="mensaje-sin-pautas">
                    <mat-icon>info</mat-icon>
                    <span>No hay pautas creadas para este plan. Utiliza el botón "Agregar Medio" para agregar medios.</span>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>

          <!-- Pie de la tabla -->
          <tfoot>
            <tr class="fila-total">
              <td>Total Inversión Neta</td>
              <td></td>
              <td colspan="5"></td>
              <td class="valor-total">{{ periodoSeleccionado.totalInversionNeta | currency:'USD':'symbol-narrow':'1.0-0' }}</td>
              <td></td>
            </tr>
            <tr class="fila-iva">
              <td>IVA 19%</td>
              <td></td>
              <td colspan="5"></td>
              <td class="valor-total">{{ periodoSeleccionado.iva | currency:'USD':'symbol-narrow':'1.0-0' }}</td>
              <td></td>
            </tr>
            <tr class="fila-total-inversion">
              <td>Total Inversión</td>
              <td></td>
              <td colspan="5"></td>
              <td class="valor-total">{{ periodoSeleccionado.totalInversion | currency:'USD':'symbol-narrow':'1.0-0' }}</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
  </div>
</div> 